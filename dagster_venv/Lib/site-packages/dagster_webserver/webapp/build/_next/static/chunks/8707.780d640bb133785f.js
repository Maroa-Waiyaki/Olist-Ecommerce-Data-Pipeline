"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8707],{26954:function(e,t,n){n.d(t,{$:function(){return M}});var r=n(52322),i=n(3842),s=n(14934),a=n(16629),o=n(1747),l=n(79106),c=n(37504),d=n(35292),u=n(39013),h=n(2784),m=n(93812),p=n(76575),f=n(28363),g=n(4733),x=n(16336),y=n(88257),j=n(4378),v=n(15332);let k=e=>{var t,n;let{setSelectedTick:i,setTableView:s,setTimerange:a,setParentStatuses:o}=e,[l,c]=(0,j.q)({queryKey:"statuses",decode:(0,h.useCallback)(e=>{let{statuses:t}=e;return new Set(t?JSON.parse(t):[y.izS.STARTED,y.izS.SUCCESS,y.izS.FAILURE,y.izS.SKIPPED])},[]),encode:(0,h.useCallback)(e=>({statuses:JSON.stringify(Array.from(e))}),[])}),{queryResult:d,paginationProps:u}=(0,v.l)({query:m.X,variables:{statuses:(0,h.useMemo)(()=>Array.from(l),[l])},nextCursorForResult:e=>{var t;let n=e.autoMaterializeTicks;if(n.length)return null===(t=n[14])||void 0===t?void 0:t.id},getResultArray:e=>(null==e?void 0:e.autoMaterializeTicks)?e.autoMaterializeTicks:[],pageSize:15});return(0,x.C4)(d,1e4,!u.hasPrevCursor),(0,h.useEffect)(()=>{if(u.hasPrevCursor){var e,t,n;let r=null===(e=d.data)||void 0===e?void 0:e.autoMaterializeTicks;if(r&&r.length){let e=null===(t=r[r.length-1])||void 0===t?void 0:t.timestamp,i=null===(n=r[0])||void 0===n?void 0:n.endTimestamp;e&&i&&a([e,i])}}else a(void 0)},[u.hasPrevCursor,null===(t=d.data)||void 0===t?void 0:t.autoMaterializeTicks,a]),(0,h.useEffect)(()=>{u.hasPrevCursor?o(Array.from(l)):o(void 0)},[u.hasPrevCursor,o,l]),(0,r.jsx)(g.V,{loading:d.loading,ticks:(null===(n=d.data)||void 0===n?void 0:n.autoMaterializeTicks)||[],paginationProps:u,setSelectedTick:i,setStatuses:c,setTableView:s,statuses:l})};var b=n(56130),w=n(36803),C=n(59502),S=n(57758),E=n(34219),T=n(71348);let M=()=>{var e;let t=(0,T.dx)(),n=(0,b.p)(),{permissions:{canToggleAutoMaterialize:g}={}}=(0,w.WB)(),[v,M]=(0,h.useState)(!1),[O,P]=(0,h.useState)(void 0),[B,A]=(0,h.useState)(void 0),D=(0,h.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return B||O?{afterTimestamp:null==B?void 0:B[0],beforeTimestamp:null==B?void 0:B[1],statuses:O}:{afterTimestamp:(e-12e5)/1e3}},[O,B]),[I,F]=(0,i.t)(m.X),N=(0,h.useCallback)(async()=>await I({variables:D()}),[I,D]);(0,E.Hu)(F,"AssetDaemonTicksQuery"),(0,x.bT)({refresh:N,enabled:!v&&!B&&!O,intervalMs:2e3,leading:!0});let[z,L]=(0,h.useState)(null),[_,R]=(0,j.q)((0,h.useMemo)(()=>({queryKey:"view",decode:e=>{let{view:t}=e;return"runs"===t?"runs":"evaluations"},encode:e=>({view:e,cursor:void 0,statuses:void 0})}),[])),$=null!==(e=F.data)&&void 0!==e?e:F.previousData,U=(0,h.useMemo)(()=>(null==$?void 0:$.autoMaterializeTicks)||[],[$]),K=(0,h.useMemo)(()=>{var e;return null!==(e=null==U?void 0:U.map((e,t)=>{let n=U[t-1];if(n&&(0,S.g6)(e,t)){let t={...e};return t.endTimestamp=n.timestamp,t.status=y.izS.FAILURE,t}return e}))&&void 0!==e?e:[]},[JSON.stringify(U.map(e=>"".concat(e.id,":").concat(e.status)))]),q=(0,h.useCallback)(e=>{M(!!e)},[M]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.x,{padding:{vertical:12,horizontal:24},flex:{direction:"column",gap:12},children:(0,r.jsx)(a.b,{intent:"info",title:"[Experimental] Dagster can automatically materialize assets when criteria are met.",description:(0,r.jsxs)(r.Fragment,{children:["Auto-materialization enables a declarative approach to asset scheduling – instead of defining imperative workflows to materialize your assets, you just describe the conditions under which they should be materialized."," ",(0,r.jsx)("a",{href:"https://docs.dagster.io/concepts/assets/asset-auto-execution",target:"_blank",rel:"noreferrer",children:"Learn more about auto-materialization here"}),"."]})})}),(0,r.jsx)(o.i,{children:(0,r.jsxs)("tbody",{children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:"Running"}),(0,r.jsx)("td",{children:t.loading?(0,r.jsx)(l.$,{purpose:"body-text"}):(0,r.jsx)(c.X,{format:"switch",checked:!t.paused,disabled:!g,onChange:async e=>{let r=e.target.checked;r||await n({title:"Pause Auto-materializing?",description:"Pausing Auto-materializing will prevent new materializations triggered by an Auto-materializing policy."}),t.setPaused(!r)}})})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:"Evaluation frequency"}),(0,r.jsx)("td",{children:"~30s"})]})]})}),(0,r.jsx)(s.x,{padding:{vertical:12,horizontal:24},border:"bottom",children:(0,r.jsx)(d.Tj,{children:"Evaluation timeline"})}),$?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.p,{ticks:K,onHoverTick:q,onSelectTick:L,exactRange:B,timeRange:12e5,tickGrid:3e5,timeAfter:18e4}),(0,r.jsx)(p.d,{tick:z,isOpen:!!z,close:()=>{L(null)}}),"evaluations"===_?(0,r.jsx)(k,{setSelectedTick:L,setTableView:R,setParentStatuses:P,setTimerange:A}):(0,r.jsx)(f.o,{setTableView:R})]}):(0,r.jsxs)(s.x,{padding:{vertical:48},flex:{direction:"row",justifyContent:"center",gap:12,alignItems:"center"},children:[(0,r.jsx)(l.$,{purpose:"body-text"}),(0,r.jsx)("div",{style:{color:u.$()},children:"Loading evaluations…"})]})]})}},7870:function(e,t,n){n.d(t,{A:function(){return P}});var r=n(73235),i=n(52322),s=n(40794),a=n(89130),o=n(14934),l=n(79106),c=n(39013),d=n(37483),u=n(80122),h=n(40782),m=n(90731),p=n(78491),f=n(23399),g=n(16336),x=n(69737),y=n(88257),j=n(20171),v=n(4378),k=n(54048),b=n(34219),w=n(15332),C=n(10481),S=n(83586);function E(){let e=(0,r._)(["\n  query InstanceHealthForBackfillsQuery {\n    instance {\n      id\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n"]);return E=function(){return e},e}function T(){let e=(0,r._)(["\n  query InstanceBackfillsQuery($status: BulkActionStatus, $cursor: String, $limit: Int) {\n    partitionBackfillsOrError(status: $status, cursor: $cursor, limit: $limit) {\n      ... on PartitionBackfills {\n        results {\n          id\n          status\n          isValidSerialization\n          numPartitions\n          timestamp\n          partitionSetName\n          partitionSet {\n            id\n            name\n            mode\n            pipelineName\n            repositoryOrigin {\n              id\n              repositoryName\n              repositoryLocationName\n            }\n          }\n          error {\n            ...PythonErrorFragment\n          }\n\n          ...BackfillTableFragment\n        }\n      }\n      ...PythonErrorFragment\n    }\n  }\n\n  ","\n  ","\n"]);return T=function(){return e},e}let M=e=>{switch(e){case y.Jv3.CANCELED:return"Canceled";case y.Jv3.CANCELING:return"Canceling";case y.Jv3.COMPLETED:return"Completed";case y.Jv3.FAILED:return"Failed";case y.Jv3.REQUESTED:return"In progress"}},O=Object.keys(y.Jv3).map(e=>{let t=M(e);return{label:t,value:e,match:[e,t]}}),P=()=>{(0,x.Px)(),(0,j.j)("Overview | Backfills");let e=(0,s.a)(B),[t,n]=(0,v.q)({encode:e=>({status:e.size?Array.from(e).join(","):void 0}),decode:e=>{var t;return new Set((null===(t=e.status)||void 0===t?void 0:t.split(","))||[])}}),r=(0,S.im)({name:"Status",icon:"status",allValues:O,allowMultipleSelections:!1,closeOnSelect:!0,renderLabel:e=>{let{value:t}=e;return(0,i.jsx)("div",{children:M(t)})},getStringValue:e=>M(e),state:t,onStateChanged:n}),{button:a,activeFiltersJsx:h}=(0,C.m)({filters:[r]}),{queryResult:p,paginationProps:y}=(0,w.l)({query:A,variables:{status:t.size>0?Array.from(t)[0]:void 0},pageSize:10,nextCursorForResult:e=>{var t;return"PartitionBackfills"===e.partitionBackfillsOrError.__typename?null===(t=e.partitionBackfillsOrError.results[9])||void 0===t?void 0:t.id:void 0},getResultArray:e=>(null==e?void 0:e.partitionBackfillsOrError.__typename)==="PartitionBackfills"?e.partitionBackfillsOrError.results:[]});(0,b.Hu)(p,"InstanceBackfillsQuery");let E=(0,g.C4)(p,g.dT),{loading:T,data:P}=p;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.x,{padding:{vertical:12,horizontal:20},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(o.x,{flex:{direction:"column",gap:8},children:[(0,i.jsx)("div",{children:a}),h]}),(0,i.jsx)(g.xi,{refreshState:E})]}),(()=>{var n;if(T&&!P)return(0,i.jsx)(o.x,{padding:{vertical:64},flex:{direction:"column",alignItems:"center"},children:(0,i.jsxs)(o.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,i.jsx)(l.$,{purpose:"body-text"}),(0,i.jsx)("div",{style:{color:c.$()},children:"Loading backfills…"})]})});let r=null==P?void 0:P.partitionBackfillsOrError;if((null==r?void 0:r.__typename)==="PythonError")return(0,i.jsx)(f.T9,{error:r});if(!r||!(null==r?void 0:r.results.length))return t.size>0?(0,i.jsx)(o.x,{padding:{vertical:64},children:(0,i.jsx)(d.t,{icon:"no-results",title:"No matching backfills",description:"No backfills were found for this filter."})}):(0,i.jsx)(o.x,{padding:{vertical:64},children:(0,i.jsx)(d.t,{icon:"no-results",title:"No backfills found",description:"This instance does not have any backfill jobs."})});let s=((null===(n=e.data)||void 0===n?void 0:n.instance.daemonHealth.allDaemonStatuses)||[]).filter(e=>"BACKFILL"===e.daemonType).map(e=>e.required&&e.healthy),a=s.length&&s.every(e=>e);return(0,i.jsxs)("div",{children:[a?null:(0,i.jsx)(o.x,{padding:{horizontal:24,vertical:16},children:(0,i.jsx)(k.B1,{})}),(0,i.jsx)(m.G,{backfills:r.results.slice(0,10),refetch:p.refetch}),r.results.length>0?(0,i.jsx)(o.x,{margin:{top:16},children:(0,i.jsx)(u.b$,{...y})}):null]})})()]})},B=(0,a.Ps)(E(),h.O),A=(0,a.Ps)(T(),p.B,m.b)},43250:function(e,t,n){n.d(t,{C:function(){return u}});var r=n(52322),i=n(92506),s=n(14934),a=n(38491),o=n(92917),l=n(2784),c=n(44231),d=n(100);let u=()=>{let{allRepos:e,visibleRepos:t,toggleVisible:n}=(0,l.useContext)(d.C5),[u,h]=(0,l.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.Vq,{canOutsideClickClose:!0,canEscapeKeyClose:!0,isOpen:u,style:{width:"auto"},onClose:()=>h(!1),children:[(0,r.jsx)(i.fK,{icon:"repo",label:"Filter code locations"}),(0,r.jsx)(c.e,{options:e,onBrowse:()=>h(!1),onToggle:n,selected:t}),(0,r.jsx)(i.cN,{children:(0,r.jsx)(s.x,{padding:{top:8},children:(0,r.jsx)(a.zx,{intent:"none",onClick:()=>h(!1),children:"Done"})})})]}),(0,r.jsx)(a.zx,{outlined:!0,icon:(0,r.jsx)(o.JO,{name:"folder"}),rightIcon:(0,r.jsx)(o.JO,{name:"expand_more"}),onClick:()=>h(!0),children:"".concat(t.length," of ").concat(e.length)})]})}},33707:function(e,t,n){n.d(t,{t4:function(){return eA}});var r=n(73235),i=n(52322),s=n(40794),a=n(89130),o=n(14934),l=n(79106),c=n(37483),d=n(73407),u=n(16629),h=n(74580),m=n(35292),p=n(39013),f=n(28879),g=n.n(f),x=n(64989),y=n.n(x),j=n(77491),v=n.n(j),k=n(2784),b=n(7267),w=n(47933),C=n(35505),S=n(84927),E=n(16336),T=n(56675);class M{constructor({fetchData:e,onData:t,onError:n}){this.hasMoreData=!0,this.dataSoFar=[],this.currentCursor=void 0,this.stopped=!1,this.fetch=async()=>{if(this.fetchPromise)return await this.fetchPromise;this.fetchPromise=new Promise(async e=>{for(this.hasMoreData=!0;this.hasMoreData&&!this.stopped;){let{cursor:e,hasMore:n,data:r,error:i}=await this.fetchData(this.currentCursor);if(this.stopped)break;if(i){var t;null===(t=this.onError)||void 0===t||t.call(this,i);break}this.currentCursor=e,this.hasMoreData=n,r.length>0&&(this.dataSoFar=this.dataSoFar.concat(r),this.onData(this.dataSoFar))}e()});let e=await this.fetchPromise;return this.fetchPromise=void 0,e},this.stop=()=>{this.stopped=!0},this.fetchData=e,this.onData=t,this.onError=n}}var O=n(18978);function P(){let e=(0,r._)(["\n  query BackfillLogsPageQuery($backfillId: String!, $cursor: String) {\n    partitionBackfillOrError(backfillId: $backfillId) {\n      __typename\n      ... on PythonError {\n        message\n      }\n      ... on BackfillNotFoundError {\n        message\n      }\n      ... on PartitionBackfill {\n        id\n        logEvents(cursor: $cursor) {\n          ... on InstigationEventConnection {\n            cursor\n            hasMore\n            events {\n              ...InstigationEventLog\n            }\n          }\n        }\n      }\n    }\n  }\n  ","\n"]);return P=function(){return e},e}let B=e=>{if("PartitionBackfill"!==e.partitionBackfillOrError.__typename)return{data:[],hasMore:!1,error:e.partitionBackfillOrError,cursor:void 0};{let{events:t,hasMore:n,cursor:r}=e.partitionBackfillOrError.logEvents;return{data:t,hasMore:n,cursor:r,error:void 0}}},A=e=>{let{backfill:t}=e,{error:n,fetched:r,refreshState:s}=function(e){let{query:t,variables:n,getResult:r}=e,[i,s]=(0,k.useState)(null),[a,o]=(0,k.useState)(null),l=(0,T.x)(),{stop:c,fetch:d}=(0,k.useMemo)(()=>new M({fetchData:async e=>r((await l.query({variables:{...n,cursor:e},query:t})).data),onData:s,onError:o}),[l,t,n,r]);return(0,k.useEffect)(()=>c,[c]),{fetched:i,error:a,refreshState:(0,E.bT)({refresh:d,intervalMs:1e4,leading:!0})}}({query:D,variables:(0,k.useMemo)(()=>({backfillId:t.id}),[t]),getResult:B});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{position:"absolute",right:16,top:-32},children:(0,i.jsx)(E.xi,{refreshState:s})}),(n&&(o.x,c.t,n.message),null===r)?(0,i.jsx)(o.x,{flex:{justifyContent:"center",alignItems:"center"},style:{flex:1},children:(0,i.jsx)(l.$,{purpose:"page"})}):0===r.length?(0,i.jsx)(o.x,{flex:{justifyContent:"center",alignItems:"center"},style:{flex:1},children:(0,i.jsx)(c.t,{title:"No logs available",description:"If backfill log storage is enabled, logs will appear as they are emitted by the backfill daemon."})}):(0,i.jsx)(O.g,{events:r})]})},D=(0,a.Ps)(P(),O.n);var I=n(1747),F=n(89891),N=n(43212),z=n(44900),L=n(31259),_=n(75442),R=n(88257),$=n(18856),U=n(77851);function K(){let e=(0,r._)(["\n  query BackfillPartitionsForAssetKey($backfillId: String!, $assetKey: AssetKeyInput!) {\n    partitionBackfillOrError(backfillId: $backfillId) {\n      ... on PartitionBackfill {\n        id\n        partitionsTargetedForAssetKey(assetKey: $assetKey) {\n          partitionKeys\n          ranges {\n            start\n            end\n          }\n        }\n      }\n    }\n  }\n"]);return K=function(){return e},e}let q=e=>{var t,n;let{backfill:r}=e,s=(0,T.x)(),a=(0,b.k6)();function l(e){let t=[{token:"tag",value:"dagster/backfill=".concat(r.id)}];switch(e){case"inProgress":t.push({token:"status",value:R.VOA.STARTED},{token:"status",value:R.VOA.QUEUED},{token:"status",value:R.VOA.STARTING},{token:"status",value:R.VOA.CANCELING},{token:"status",value:R.VOA.NOT_STARTED});break;case"complete":t.push({token:"status",value:R.VOA.SUCCESS});break;case"failed":t.push({token:"status",value:R.VOA.FAILURE}),t.push({token:"status",value:R.VOA.CANCELED})}return(0,$.it)(t)}let d=async(e,t)=>{let n={};if(t){var i;let t=await s.query({query:Q,variables:{backfillId:r.id,assetKey:(0,L.W1)(e)}}),a="PartitionBackfill"===t.data.partitionBackfillOrError.__typename?t.data.partitionBackfillOrError.partitionsTargetedForAssetKey:null;a&&(null===(i=a.ranges)||void 0===i?void 0:i.length)&&(n={default_range:a.ranges.map(e=>"[".concat(e.start,"...").concat(e.end,"]")).join(",")})}return a.push((0,_.p)(e,n))};return(null===(t=r.assetBackfillData)||void 0===t?void 0:t.assetBackfillStatuses.length)?(0,i.jsxs)(I.i,{children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{width:"50%"},children:"Asset name"}),(0,i.jsx)("th",{children:(0,i.jsx)(w.rU,{to:l("targeted"),children:"Partitions targeted"})}),(0,i.jsx)("th",{children:(0,i.jsx)(w.rU,{to:l("inProgress"),children:"In progress"})}),(0,i.jsx)("th",{children:(0,i.jsx)(w.rU,{to:l("complete"),children:"Completed"})}),(0,i.jsx)("th",{children:(0,i.jsx)(w.rU,{to:l("failed"),children:"Failed"})})]})}),(0,i.jsx)("tbody",{children:null===(n=r.assetBackfillData)||void 0===n?void 0:n.assetBackfillStatuses.map(e=>{let t,n,r,s;return"AssetPartitionsStatusCounts"===e.__typename?(t=e.numPartitionsTargeted,n=e.numPartitionsInProgress,r=e.numPartitionsMaterialized,s=e.numPartitionsFailed):(t=1,s=e.failed?1:0,n=e.inProgress?1:0,r=e.materialized?1:0),(0,i.jsxs)("tr",{"data-testid":(0,U.N)("backfill-asset-row-".concat((0,z.Je)(e.assetKey))),children:[(0,i.jsx)("td",{children:(0,i.jsxs)(o.x,{flex:{direction:"row",justifyContent:"space-between"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(F.Z,{onClick:()=>d(e.assetKey,"AssetPartitionsStatusCounts"===e.__typename),children:e.assetKey.path.join("/")})}),(0,i.jsx)("div",{children:(0,i.jsx)(V,{targeted:t,inProgress:n,completed:r,failed:s})})]})}),"AssetPartitionsStatusCounts"===e.__typename?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("td",{children:t}),(0,i.jsx)("td",{children:n}),(0,i.jsx)("td",{children:r}),(0,i.jsx)("td",{children:s})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("td",{children:"-"}),(0,i.jsx)("td",{children:n?(0,i.jsx)(N.V,{icon:"spinner",intent:"primary",children:"In progress"}):"-"}),(0,i.jsx)("td",{children:r?(0,i.jsx)(N.V,{intent:"success",children:"Completed"}):"-"}),(0,i.jsx)("td",{children:s?(0,i.jsx)(N.V,{intent:"danger",children:"Failed"}):"-"})]})]},(0,z.Je)(e.assetKey))})})]}):(0,i.jsx)(o.x,{margin:48,children:(0,i.jsx)(c.t,{title:"Partition statuses unavailable",description:"Dagster was unable to load per-partition statuses. This may occur if the backfilled assets or jobs no longer exist in your loaded code locations."})})},Q=(0,a.Ps)(K());function V(e){let{targeted:t,inProgress:n,completed:r,failed:s}=e;return(0,i.jsxs)("div",{style:{borderRadius:"8px",backgroundColor:p.gJ(),display:"grid",gridTemplateColumns:"".concat(100*r/t,"% ").concat(100*s/t,"% ").concat(100*n/t,"%"),gridTemplateRows:"100%",height:"12px",width:"200px",overflow:"hidden"},children:[(0,i.jsx)("div",{style:{background:p.fA()}}),(0,i.jsx)("div",{style:{background:p.FY()}}),(0,i.jsx)("div",{style:{background:p.L$()}})]})}var H=n(51484),J=n(38491),W=n(80122),Y=n(43111),G=n(60129),Z=n(88510),X=n(54516),ee=n(96850),et=n(2278),en=n(77539),er=n(79464),ei=n(17008);let{DATE_TIME_HEIGHT:es,ONE_HOUR_MSEC:ea,EMPTY_STATE_HEIGHT:eo,LEFT_SIDE_SPACE_ALLOTTED:el}=ee.CONSTANTS,ec=e=>{let{loading:t=!1,runs:n,rangeMs:r,annotations:s,now:a}=e,l=k.useRef(null),{viewport:{width:c,height:d},containerProps:{ref:u}}=(0,G.S)(),h=(0,Z.MG)({count:n.length,getScrollElement:()=>l.current,estimateSize:e=>32,overscan:40}),m=h.getTotalSize(),p=h.getVirtualItems();return c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.x,{padding:{left:24},border:"bottom",flex:{direction:"column",justifyContent:"center"},style:{fontSize:"16px",flex:"0 0 ".concat(es,"px")}}),(0,i.jsx)("div",{style:{position:"relative"},children:(0,i.jsx)(ee.G7,{now:a,interval:r[1]-r[0]>4*ea?ea:ea/6,rangeMs:r,annotations:s,height:n.length>0?d:0})}),n.length?(0,i.jsx)("div",{ref:u,style:{overflow:"hidden",position:"relative"},children:(0,i.jsx)(ei.W2,{ref:l,children:(0,i.jsx)(ei.Nh,{$totalHeight:m,children:p.map(e=>{let{index:t,key:s,size:a,start:o}=e;return(0,i.jsx)(ed,{run:n[t],top:o,height:a,range:r,width:c},s)})})})}):(0,i.jsx)("div",{ref:u,children:(0,i.jsx)(ee.oO,{loading:t,includesTicks:!1})})]}):(0,i.jsx)("div",{style:{height:es+eo},ref:u})},ed=e=>{let{run:t,top:n,height:r,range:s,width:a}=e,[l,c]=s,d=a-el,u=k.useMemo(()=>(0,en.i)({runs:[t],start:l,end:c,width:d,minChunkWidth:4,minMultipleWidth:4})[0],[t,l,c,d]);return(0,i.jsxs)(ee.AJ,{$height:r,$start:n,children:[(0,i.jsxs)(o.x,{style:{width:el},padding:{horizontal:24},flex:{justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)(o.x,{flex:{alignItems:"center",gap:4},children:[(0,i.jsx)(X.O_,{status:t.status,size:12}),(0,i.jsx)(w.rU,{to:"/runs/".concat(t.id),children:t.id.slice(0,8)})]}),(0,i.jsx)(et.Q,{startUnix:t.startTime/1e3,endUnix:t.endTime/1e3})]}),(0,i.jsx)(ee.p0,{children:u&&(0,i.jsx)(ee.Dv,{$background:(0,er.v)(u.runs),$multiple:!1,style:{left:"".concat(u.left,"px"),width:"".concat(u.width,"px")}})})]})};var eu=n(4378),eh=n(64895),em=n(89010),ep=n(43984),ef=n(6268),eg=n(48162),ex=n(85062);let ey=e=>{let{backfill:t}=e,[n,r]=(0,eu.q)({defaults:{view:"timeline"},queryKey:"view"}),{rangeMs:s,hourWindow:a,setHourWindow:l,onPageEarlier:c,onPageLater:d,onPageNow:u}=(0,eh.g)({maxNowMs:t.endTimestamp?1e3*t.endTimestamp:void 0,hourWindowStorageKey:"dagster.backfill-run-timeline-hour-window",lookaheadHours:.1}),h=(0,k.useMemo)(()=>({tags:[{key:ep.H.Backfill,value:t.id}]}),[t]),m=(0,k.useMemo)(()=>t.endTimestamp?[{ms:1e3*t.timestamp,label:"Start"},{ms:1e3*t.endTimestamp,label:"End"}]:[{ms:1e3*t.timestamp,label:"Start"}],[t.timestamp,t.endTimestamp]),p=(0,i.jsxs)(o.x,{flex:{direction:"row",gap:16},style:{position:"sticky",top:0},children:[(0,i.jsx)(H.h,{activeItems:new Set([n]),onClick:e=>{r(e)},buttons:[{id:"timeline",icon:"gantt_waterfall",label:"Timeline"},{id:"list",icon:"list",label:"List"}]}),(0,i.jsx)("div",{style:{flex:1}}),"timeline"===n&&(0,i.jsx)(H.h,{activeItems:new Set([a]),buttons:[{id:"1",label:"1hr"},{id:"6",label:"6hr"},{id:"12",label:"12hr"},{id:"24",label:"24hr"}],onClick:e=>l(e)}),"timeline"===n&&(0,i.jsxs)(o.x,{flex:{direction:"row",gap:4,alignItems:"center"},children:[(0,i.jsx)(J.zx,{onClick:c,children:"←"}),(0,i.jsx)(J.zx,{onClick:u,children:t.endTimestamp?"Jump to End":"Now"}),(0,i.jsx)(J.zx,{onClick:d,children:"→"})]})]});return"timeline"===n?(0,i.jsx)(ev,{filter:h,rangeMs:s,annotations:m,actionBarComponents:p}):(0,i.jsx)(ej,{filter:h,actionBarComponents:p})},ej=e=>{var t;let{filter:n,actionBarComponents:r}=e,{queryResult:s,paginationProps:a}=(0,ef.usePaginatedRunsTableRuns)(n),d=null===(t=s.data)||void 0===t?void 0:t.pipelineRunsOrError,u=(0,E.C4)(s,15e3);return d?"Runs"!==d.__typename?(0,i.jsx)(o.x,{padding:{vertical:64},children:(0,i.jsx)(c.t,{icon:"error",title:"Query Error",description:d.message})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{position:"absolute",right:16,top:-32},children:(0,i.jsx)(E.xi,{refreshState:u})}),(0,i.jsx)(o.x,{style:{flex:1,overflowY:"auto"},children:(0,i.jsxs)(ex.Y,{$top:56,children:[(0,i.jsx)(em.AL,{runs:d.results,actionBarComponents:r,actionBarSticky:!0}),d.results.length>0?(0,i.jsx)(o.x,{margin:{vertical:16},children:(0,i.jsx)(W.pI,{...a})}):null]})})]}):(0,i.jsx)(o.x,{padding:{vertical:48},children:(0,i.jsx)(l.$,{purpose:"page"})})},ev=e=>{let{rangeMs:t,annotations:n,filter:r,actionBarComponents:s}=e,a=(0,eg.Zx)({refreshInterval:2*E.dT,showTicks:!1,rangeMs:t,filter:r}),{jobs:l,loading:c}=(0,k.useDeferredValue)(a),d=l[0],{runs:u,now:h}=k.useMemo(()=>{let e=Date.now();return d?{runs:[...d.runs].sort((e,t)=>t.startTime-e.startTime),now:e}:{runs:[],now:e}},[d]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{position:"absolute",right:16,top:-32},children:(0,i.jsx)(E.xi,{refreshState:a.refreshState})}),(0,i.jsx)(o.x,{padding:{horizontal:24,vertical:12},style:{position:"sticky",top:0,zIndex:2,background:p.v8()},border:"bottom",children:s}),(0,i.jsx)(Y.S,{region:"timeline",children:(0,i.jsx)(ec,{loading:c,rangeMs:t,annotations:n,runs:u,now:h})})]})};var ek=n(32959),eb=n(34667),ew=n(32093),eC=n(78491),eS=n(23399),eE=n(69737),eT=n(22791),eM=n(20171),eO=n(34219);function eP(){let e=(0,r._)(["\n  query BackfillStatusesByAsset($backfillId: String!) {\n    partitionBackfillOrError(backfillId: $backfillId) {\n      ...BackfillDetailsBackfillFragment\n      ...PythonErrorFragment\n      ... on BackfillNotFoundError {\n        message\n      }\n    }\n  }\n\n  fragment BackfillDetailsBackfillFragment on PartitionBackfill {\n    id\n    status\n    timestamp\n    endTimestamp\n    numPartitions\n    ...BackfillActionsBackfillFragment\n\n    error {\n      ...PythonErrorFragment\n    }\n    assetBackfillData {\n      rootTargetedPartitions {\n        partitionKeys\n        ranges {\n          start\n          end\n        }\n      }\n      assetBackfillStatuses {\n        ... on AssetPartitionsStatusCounts {\n          assetKey {\n            path\n          }\n          numPartitionsTargeted\n          numPartitionsInProgress\n          numPartitionsMaterialized\n          numPartitionsFailed\n        }\n        ... on UnpartitionedAssetStatus {\n          assetKey {\n            path\n          }\n          inProgress\n          materialized\n          failed\n        }\n      }\n    }\n  }\n\n  ","\n  ","\n"]);return eP=function(){return e},e}function eB(){let e=(0,r._)(["\n  query BackfillPartitionsForAssetKey($backfillId: String!, $assetKey: AssetKeyInput!) {\n    partitionBackfillOrError(backfillId: $backfillId) {\n      ... on PartitionBackfill {\n        id\n        partitionsTargetedForAssetKey(assetKey: $assetKey) {\n          partitionKeys\n          ranges {\n            start\n            end\n          }\n        }\n      }\n    }\n  }\n"]);return eB=function(){return e},e}g().extend(y()),g().extend(v());let eA=()=>{let{featureContext:e}=(0,k.useContext)(ew.U),{backfillId:t}=(0,b.UO)();(0,eE.Px)(),(0,eM.j)("Backfill | ".concat(t));let[n,r]=(0,eu.q)({queryKey:"tab",defaults:{tab:"partitions"}}),a=(0,s.a)(eN,{variables:{backfillId:t}});(0,eO.Hu)(a,"BackfillStatusesByAssetQuery");let{data:f,error:g}=a,x=(null==f?void 0:f.partitionBackfillOrError.__typename)==="PartitionBackfill"?f.partitionBackfillOrError:null,y=!x||[R.Jv3.REQUESTED,R.Jv3.CANCELING].includes(x.status),j=(0,E.C4)(a,1e4,y);return(0,i.jsxs)(o.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,i.jsx)(h.m,{title:(0,i.jsxs)(m.X6,{children:[(0,i.jsx)(w.rU,{to:"/overview/backfills",style:{color:p.$()},children:"Backfills"})," / ",t]}),right:(0,i.jsxs)(o.x,{flex:{gap:12,alignItems:"center"},children:[y?(0,i.jsx)(E.xi,{refreshState:j}):null,x?(0,i.jsx)(S.WH,{backfill:x,refetch:a.refetch,canCancelRuns:x.status===R.Jv3.REQUESTED}):null]})}),function(){var t;if(!f||!f.partitionBackfillOrError)return(0,i.jsx)(o.x,{padding:64,"data-testid":(0,U.N)("page-loading-indicator"),children:(0,i.jsx)(l.$,{purpose:"page"})});if("PythonError"===f.partitionBackfillOrError.__typename)return(0,i.jsx)(eS.T9,{error:f.partitionBackfillOrError});if("BackfillNotFoundError"===f.partitionBackfillOrError.__typename)return(0,i.jsx)(c.t,{icon:"no-results",title:f.partitionBackfillOrError.message});let s=f.partitionBackfillOrError;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.x,{padding:24,flex:{direction:"row",justifyContent:"space-between",wrap:"nowrap",alignItems:"center"},"data-testid":(0,U.N)("backfill-page-details"),children:[(0,i.jsx)(eD,{label:"Created",detail:(0,i.jsx)(eT.E,{timestamp:{ms:Number(1e3*s.timestamp)},timeFormat:{showSeconds:!0,showTimezone:!1}})}),(0,i.jsx)(eD,{label:"Duration",detail:(0,i.jsx)(eF,{start:1e3*s.timestamp,end:s.endTimestamp?1e3*s.endTimestamp:null})}),(0,i.jsx)(eD,{label:"Partition selection",detail:(0,i.jsx)(eb.b,{targetPartitionCount:s.numPartitions||0,targetPartitions:null===(t=s.assetBackfillData)||void 0===t?void 0:t.rootTargetedPartitions})}),(0,i.jsx)(eD,{label:"Status",detail:(0,i.jsx)(ek.w,{backfill:s})})]}),(0,i.jsx)(o.x,{padding:{left:24},border:"bottom",children:(0,i.jsxs)(d.mQ,{size:"large",selectedTabId:n,children:[(0,i.jsx)(d.OK,{id:"partitions",title:"Partitions",onClick:()=>r("partitions")}),(0,i.jsx)(d.OK,{id:"runs",title:"Runs",onClick:()=>r("runs")}),e.canSeeBackfillCoordinatorLogs?(0,i.jsx)(d.OK,{id:"logs",title:"Coordinator logs",onClick:()=>r("logs")}):null]})}),(null==g?void 0:g.graphQLErrors)&&(0,i.jsx)(u.b,{intent:"error",title:g.graphQLErrors.map(e=>e.message)}),(0,i.jsxs)(o.x,{flex:{direction:"column"},style:{flex:1,position:"relative",minHeight:0,overflowY:"scroll"},children:["partitions"===n&&(0,i.jsx)(q,{backfill:s}),"runs"===n&&(0,i.jsx)(ey,{backfill:s}),"logs"===n&&(0,i.jsx)(A,{backfill:s})]})]})}()]})},eD=e=>{let{label:t,detail:n}=e;return(0,i.jsxs)(o.x,{flex:{direction:"column",gap:4},style:{minWidth:"280px"},children:[(0,i.jsx)(eI,{children:t}),(0,i.jsx)("div",{children:n})]})},eI=C.ZP.div.withConfig({componentId:"sc-29d088f-0"})(["color:",";font-size:12px;line-height:16px;"],p.$()),eF=e=>{let{start:t,end:n}=e,[r,s]=(0,k.useReducer)((e,t)=>e+1,0);(0,k.useEffect)(()=>{if(n)return;let e=setInterval(s,6e4);return()=>clearInterval(e)},[t,n]);let a=n?n-t:Date.now()-t;return(0,i.jsx)("span",{children:ez(a)})},eN=(0,a.Ps)(eP(),eC.B,S.V2);(0,a.Ps)(eB());let ez=e=>{let t=Math.floor(e/6e4%60),n=Math.floor(e/36e5%24),r=Math.floor(e/864e5),i="";return r>0?i+="".concat(r,"d ")+"".concat(n,"h"):n>0?i+="".concat(n,"h ")+"".concat(t,"m"):t>0&&(i+="".concat(t,"m ")+"".concat(Math.floor(e/1e3%60),"s")),i.trim()}},6685:function(e,t,n){n.d(t,{z:function(){return Q}});var r=n(73235),i=n(52322),s=n(40794),a=n(89130),o=n(14934),l=n(79106),c=n(39013),d=n(37483),u=n(74159),h=n(35002),m=n(2784),p=n(17702),f=n(43212),g=n(88510),x=n(22921),y=n(87209),j=n(17008),v=n(98956),k=n(50646),b=n(6624),w=n(83738),C=n(22563);let S=e=>{let{repos:t,headerCheckbox:n,checkedKeys:r,onToggleCheckFactory:s}=e,a=m.useRef(null),o=m.useMemo(()=>t.map(e=>{let{repoAddress:t}=e;return(0,C.Uz)(t)}),[t]),{expandedKeys:l,onToggle:c,onToggleAll:d}=(0,k.N)(x.y,o),u=m.useMemo(()=>{let e=[];return t.forEach(t=>{let{repoAddress:n,schedules:r}=t;e.push({type:"header",repoAddress:n,scheduleCount:r.length});let i=(0,C.Uz)(n);l.includes(i)&&r.forEach(t=>{e.push({type:"schedule",repoAddress:n,schedule:t})})}),e},[t,l]),p=(0,v.w)(t.map(e=>{let{repoAddress:t}=e;return t.name})),S=(0,g.MG)({count:u.length,getScrollElement:()=>a.current,estimateSize:e=>{let t=u[e];return(null==t?void 0:t.type)==="header"?32:64},overscan:10}),E=S.getTotalSize(),T=S.getVirtualItems();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{style:{overflow:"hidden"},children:(0,i.jsxs)(j.W2,{ref:a,children:[(0,i.jsx)(b.o,{checkbox:n}),(0,i.jsx)(j.Nh,{$totalHeight:E,children:T.map(e=>{let{index:t,key:a,size:o,start:m}=e,g=u[t];if("header"===g.type)return(0,i.jsx)(w.vG,{repoAddress:g.repoAddress,height:o,start:m,onToggle:c,onToggleAll:d,expanded:l.includes((0,C.Uz)(g.repoAddress)),showLocation:p.has(g.repoAddress.name),rightElement:(0,i.jsx)(h.u,{content:1===g.scheduleCount?"1 schedule":"".concat(g.scheduleCount," schedules"),placement:"top",children:(0,i.jsx)(f.V,{children:g.scheduleCount})})},a);let x=(0,y.g)(g.repoAddress,g.schedule.name);return(0,i.jsx)(b.i,{name:g.schedule.name,scheduleState:g.schedule.scheduleState,showCheckboxColumn:!!n,checked:r.has(x),onToggleChecked:s(x),repoAddress:g.repoAddress,height:o,start:m},a)})})]})})})};var E=n(907),T=n(49455),M=n(78491),O=n(16336),P=n(4378),B=n(52154),A=n(40782),D=n(77044),I=n(34219),F=n(70468),N=n(74050),z=n(2389),L=n(10481),_=n(50027),R=n(2949),$=n(73658),U=n(100),K=n(65822);function q(){let e=(0,r._)(["\n  query OverviewSchedulesQuery {\n    workspaceOrError {\n      ... on Workspace {\n        id\n        locationEntries {\n          id\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                schedules {\n                  id\n                  name\n                  description\n                  scheduleState {\n                    id\n                    ...BasicInstigationStateFragment\n                  }\n                }\n              }\n            }\n            ...PythonErrorFragment\n          }\n        }\n      }\n      ...PythonErrorFragment\n    }\n    instance {\n      id\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n  ","\n  ","\n"]);return q=function(){return e},e}let Q=()=>{let{allRepos:e,visibleRepos:t,loading:n,data:r}=(0,m.useContext)(U.C5),a=e.length,[p,f]=(0,P.q)({queryKey:"search",defaults:{search:""}}),g=(0,_.A)(),x=(0,R.g)(),j=(0,m.useMemo)(()=>[g,x],[g,x]),{button:v,activeFiltersJsx:k}=(0,L.m)({filters:j}),b=(0,s.a)(H,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),{data:w,loading:E}=b;(0,I.Hu)(b,"OverviewSchedulesQuery");let M=(0,O.C4)(b,O.dT),A=(0,m.useMemo)(()=>{let e=(0,T.S)(t),n=Object.values(r).filter(e=>"WorkspaceLocationEntry"===e.__typename),i=null==w?void 0:w.workspaceOrError;return V((null==i?void 0:i.__typename)==="Workspace"?i.locationEntries:n).filter(t=>{let{repoAddress:n}=t;return e.has((0,C.Uz)(n))})},[w,r,t]),{state:K}=x,q=(0,m.useMemo)(()=>A.map(e=>{let{schedules:t,...n}=e;return{...n,schedules:K.size?t.filter(e=>{let{scheduleState:t}=e;return K.has(t.status)}):t}}),[A,K]),Q=p.trim().toLocaleLowerCase(),J=Q.length>0,W=(0,m.useMemo)(()=>{let e=Q.toLocaleLowerCase();return q.map(t=>{let{repoAddress:n,schedules:r}=t;return{repoAddress:n,schedules:r.filter(t=>{let{name:n}=t;return n.toLocaleLowerCase().includes(e)})}}).filter(e=>{let{schedules:t}=e;return t.length>0})},[q,Q]),Y=(0,m.useMemo)(()=>W.some(e=>{let{schedules:t}=e;return t.length>0}),[W]),G=(0,m.useMemo)(()=>A.map(e=>{let{repoAddress:t,schedules:n}=e;return n.filter(e=>{let{scheduleState:t}=e;return(0,D.i)(t)}).map(e=>{let{name:n,scheduleState:r}=e;return{repoAddress:t,scheduleName:n,scheduleState:r}})}).flat(),[A]),Z=(0,m.useMemo)(()=>G.map(e=>{let{repoAddress:t,scheduleName:n}=e;return(0,y.g)(t,n)}),[G]),[{checkedIds:X},{onToggleFactory:ee,onToggleAll:et}]=(0,B.a)(Z),en=(0,m.useMemo)(()=>{let e=new Set(W.map(e=>{let{repoAddress:t,schedules:n}=e;return n.map(e=>{let{name:n}=e;return(0,y.g)(t,n)})}).flat());return Z.filter(t=>e.has(t))},[Z,W]),er=(0,m.useMemo)(()=>{let e=new Set(en.filter(e=>X.has(e)));return G.filter(t=>{let{repoAddress:n,scheduleName:r}=t;return e.has((0,y.g)(n,r))})},[en,G,X]),ei=Z.length>0,es=er.length,ea=n&&!a&&E&&!w,eo=E&&!w;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.x,{padding:{horizontal:24,vertical:16},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(o.x,{flex:{direction:"row",gap:12},children:[v,(0,i.jsx)(u.oi,{icon:"search",value:p,rightElement:eo?(0,i.jsx)($.W,{tooltipContent:"Loading schedules…"}):void 0,onChange:e=>{f(e.target.value),et(!1)},placeholder:"Filter by schedule name…",style:{width:"340px"}})]}),(0,i.jsx)(h.u,{content:"You do not have permission to start or stop these schedules",canShow:Y&&!ei,placement:"top-end",useDisabledButtonTooltipFix:!0,children:(0,i.jsx)(F._,{schedules:er,onDone:()=>M.refetch()})})]}),k.length?(0,i.jsx)(o.x,{padding:{vertical:8,horizontal:24},border:"top-and-bottom",flex:{direction:"row",gap:8},children:k}):null,ea&&!a?(0,i.jsx)(o.x,{padding:64,children:(0,i.jsx)(l.$,{purpose:"page"})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.K,{daemonHealth:null==w?void 0:w.instance.daemonHealth,padding:{vertical:16,horizontal:24},border:"top"}),(()=>{if(ea)return(0,i.jsx)(o.x,{flex:{direction:"row",justifyContent:"center"},style:{paddingTop:"100px"},children:(0,i.jsxs)(o.x,{flex:{direction:"row",alignItems:"center",gap:16},children:[(0,i.jsx)(l.$,{purpose:"body-text"}),(0,i.jsx)("div",{style:{color:c.$()},children:"Loading schedules…"})]})});let n=e.length>t.length;return W.length?(0,i.jsx)(S,{headerCheckbox:ei?(0,i.jsx)(z.W,{checkedCount:es,totalCount:en.length,onToggleAll:et}):void 0,repos:W,checkedKeys:X,onToggleCheckFactory:ee}):J?(0,i.jsx)(o.x,{padding:{top:20},children:(0,i.jsx)(d.t,{icon:"search",title:"No matching schedules",description:n?(0,i.jsxs)("div",{children:["No schedules matching ",(0,i.jsx)("strong",{children:p})," were found in the selected code locations"]}):(0,i.jsxs)("div",{children:["No schedules matching ",(0,i.jsx)("strong",{children:p})," were found in your definitions"]})})}):(0,i.jsx)(o.x,{padding:{top:20},children:(0,i.jsx)(d.t,{icon:"search",title:"No schedules",description:n?"No matching schedules were found in the selected code locations":"No matching schedules were found in your definitions"})})})()]})]})},V=e=>{let t=e.map(e=>e.locationOrLoadError),n=[];for(let e of t)if((null==e?void 0:e.__typename)==="RepositoryLocation")for(let t of e.repositories){let{name:r,schedules:i}=t,s=(0,K.kQ)(r,e.name),a=i.map(e=>{let{name:t,scheduleState:n}=e;return{name:t,scheduleState:n}});a.length>0&&n.push({repoAddress:s,schedules:a})}return(0,E.S)(n)},H=(0,a.Ps)(q(),p.i,M.B,A.O)},80089:function(e,t,n){n.d(t,{n:function(){return Y}});var r=n(73235),i=n(52322),s=n(40794),a=n(89130),o=n(14934),l=n(79106),c=n(39013),d=n(37483),u=n(74159),h=n(35002),m=n(2784),p=n(17702),f=n(43212),g=n(88510),x=n(22921),y=n(40389),j=n(17008),v=n(98956),k=n(50646),b=n(53029),w=n(83738),C=n(22563);let S=e=>{let{repos:t,headerCheckbox:n,checkedKeys:r,onToggleCheckFactory:s}=e,a=m.useRef(null),o=m.useMemo(()=>t.map(e=>{let{repoAddress:t}=e;return(0,C.Uz)(t)}),[t]),{expandedKeys:l,onToggle:c,onToggleAll:d}=(0,k.N)(x.y,o),u=m.useMemo(()=>{let e=[];return t.forEach(t=>{let{repoAddress:n,sensors:r}=t;e.push({type:"header",repoAddress:n,sensorCount:r.length});let i=(0,C.Uz)(n);l.includes(i)&&r.forEach(t=>{e.push({type:"sensor",repoAddress:n,sensor:t})})}),e},[t,l]),p=(0,v.w)(t.map(e=>{let{repoAddress:t}=e;return t.name})),S=(0,g.MG)({count:u.length,getScrollElement:()=>a.current,estimateSize:e=>{let t=u[e];return(null==t?void 0:t.type)==="header"?32:64},overscan:10}),E=S.getTotalSize(),T=S.getVirtualItems();return(0,i.jsx)("div",{style:{overflow:"hidden"},children:(0,i.jsxs)(j.W2,{ref:a,children:[(0,i.jsx)(b.KF,{checkbox:n}),(0,i.jsx)(j.Nh,{$totalHeight:E,children:T.map(e=>{let{index:t,key:a,size:o,start:m}=e,g=u[t];if("header"===g.type)return(0,i.jsx)(w.vG,{repoAddress:g.repoAddress,height:o,start:m,onToggle:c,onToggleAll:d,expanded:l.includes((0,C.Uz)(g.repoAddress)),showLocation:p.has(g.repoAddress.name),rightElement:(0,i.jsx)(h.u,{content:1===g.sensorCount?"1 sensor":"".concat(g.sensorCount," sensors"),placement:"top",children:(0,i.jsx)(f.V,{children:g.sensorCount})})},a);let x=(0,y.x)(g.repoAddress,g.sensor.name);return(0,i.jsx)(b.Rx,{name:g.sensor.name,sensorState:g.sensor.sensorState,showCheckboxColumn:!!n,checked:r.has(x),onToggleChecked:s(x),repoAddress:g.repoAddress,height:o,start:m},a)})})]})})};var E=n(907),T=n(49455),M=n(78491),O=n(16336),P=n(88257),B=n(4378),A=n(52154),D=n(40782),I=n(77044),F=n(34219),N=n(64265),z=n(5409),L=n(2389),_=n(10481),R=n(50027),$=n(2949),U=n(83586),K=n(73658),q=n(100),Q=n(65822);function V(){let e=(0,r._)(["\n  query OverviewSensorsQuery {\n    workspaceOrError {\n      ... on Workspace {\n        id\n        locationEntries {\n          id\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                sensors {\n                  id\n                  name\n                  description\n                  sensorType\n                  sensorState {\n                    id\n                    ...BasicInstigationStateFragment\n                  }\n                }\n              }\n            }\n            ...PythonErrorFragment\n          }\n        }\n      }\n      ...PythonErrorFragment\n    }\n    instance {\n      id\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n  ","\n  ","\n"]);return V=function(){return e},e}function H(e){let t=b.W_[e].name;return{label:t,value:{type:e,label:t},match:[t]}}let J={[P.dEY.ASSET]:H(P.dEY.ASSET),[P.dEY.AUTO_MATERIALIZE]:H(P.dEY.AUTO_MATERIALIZE),[P.dEY.AUTOMATION]:H(P.dEY.AUTOMATION),[P.dEY.FRESHNESS_POLICY]:H(P.dEY.FRESHNESS_POLICY),[P.dEY.MULTI_ASSET]:H(P.dEY.MULTI_ASSET),[P.dEY.RUN_STATUS]:H(P.dEY.RUN_STATUS),[P.dEY.STANDARD]:H(P.dEY.STANDARD)},W=Object.values(J),Y=()=>{let{allRepos:e,visibleRepos:t,loading:n,data:r}=(0,m.useContext)(q.C5);e.length;let[a,p]=(0,B.q)({queryKey:"search",defaults:{search:""}}),[f,g]=(0,B.q)({encode:e=>({sensorType:e.size?Array.from(e).join(","):void 0}),decode:e=>{var t;return new Set((null===(t=e.sensorType)||void 0===t?void 0:t.split(","))||[])}}),x=(0,R.A)(),j=(0,$.g)(),v=(0,U.im)({name:"Sensor type",allValues:W,icon:"sensors",getStringValue:e=>e.label,state:(0,m.useMemo)(()=>new Set(Array.from(f).map(e=>J[e].value)),[f]),renderLabel:e=>{let{value:t}=e;return(0,i.jsx)("span",{children:t.label})},onStateChanged:e=>{g(new Set(Array.from(e).map(e=>e.type)))}}),k=(0,m.useMemo)(()=>[x,j,v],[x,j,v]),{button:b,activeFiltersJsx:w}=(0,_.m)({filters:k}),E=(0,s.a)(Z,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),{data:M,loading:P}=E;(0,F.Hu)(E,"OverviewSensorsQuery");let D=(0,O.C4)(E,O.dT),Q=(0,m.useMemo)(()=>{let e=Object.values(r).filter(e=>"WorkspaceLocationEntry"===e.__typename),n=null==M?void 0:M.workspaceOrError,i=(null==n?void 0:n.__typename)==="Workspace"?n.locationEntries:e,s=(0,T.S)(t);return G(i).filter(e=>{let{repoAddress:t}=e;return s.has((0,C.Uz)(t))})},[M,r,t]),{state:V}=j,H=(0,m.useMemo)(()=>Q.map(e=>{let{sensors:t,...n}=e;return{...n,sensors:t.filter(e=>{let{sensorState:t,sensorType:n}=e;return(!V.size||!!V.has(t.status))&&(!f.size||!!f.has(n))})}}),[Q,V,f]),Y=a.trim().toLocaleLowerCase(),X=Y.length>0,ee=(0,m.useMemo)(()=>{let e=Y.toLocaleLowerCase();return H.map(t=>{let{repoAddress:n,sensors:r}=t;return{repoAddress:n,sensors:r.filter(t=>{let{name:n}=t;return n.toLocaleLowerCase().includes(e)})}}).filter(e=>{let{sensors:t}=e;return t.length>0})},[H,Y]),et=(0,m.useMemo)(()=>ee.some(e=>{let{sensors:t}=e;return t.length>0}),[ee]),en=(0,m.useMemo)(()=>Q.map(e=>{let{repoAddress:t,sensors:n}=e;return n.filter(e=>{let{sensorState:t}=e;return(0,I.i)(t)}).map(e=>{let{name:n,sensorState:r}=e;return{repoAddress:t,sensorName:n,sensorState:r}})}).flat(),[Q]),er=(0,m.useMemo)(()=>en.map(e=>{let{repoAddress:t,sensorName:n}=e;return(0,y.x)(t,n)}),[en]),[{checkedIds:ei},{onToggleFactory:es,onToggleAll:ea}]=(0,A.a)(er),eo=(0,m.useMemo)(()=>{let e=new Set(ee.map(e=>{let{repoAddress:t,sensors:n}=e;return n.map(e=>{let{name:n}=e;return(0,y.x)(t,n)})}).flat());return er.filter(t=>e.has(t))},[er,ee]),el=(0,m.useMemo)(()=>{let e=new Set(eo.filter(e=>ei.has(e)));return en.filter(t=>{let{repoAddress:n,sensorName:r}=t;return e.has((0,y.x)(n,r))})},[eo,en,ei]),ec=er.length>0,ed=el.length,eu=n&&P&&!M,eh=P&&!M;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.x,{padding:{horizontal:24,vertical:16},flex:{direction:"row",alignItems:"center",justifyContent:"space-between",gap:12,grow:0},children:[(0,i.jsxs)(o.x,{flex:{direction:"row",gap:12},children:[b,(0,i.jsx)(u.oi,{icon:"search",value:a,rightElement:eh?(0,i.jsx)(K.W,{tooltipContent:"Loading sensors…"}):void 0,onChange:e=>p(e.target.value),placeholder:"Filter by sensor name…",style:{width:"340px"}})]}),(0,i.jsxs)(o.x,{flex:{direction:"row",gap:12,alignItems:"center"},children:[(0,i.jsx)(O.xi,{refreshState:D}),(0,i.jsx)(h.u,{content:"You do not have permission to start or stop these schedules",canShow:et&&!ec,placement:"top-end",useDisabledButtonTooltipFix:!0,children:(0,i.jsx)(N.b,{sensors:el,onDone:()=>D.refetch()})})]})]}),w.length?(0,i.jsx)(o.x,{padding:{vertical:8,horizontal:24},border:"top-and-bottom",flex:{direction:"row",gap:8},children:w}):null,eu?(0,i.jsx)(o.x,{padding:64,children:(0,i.jsx)(l.$,{purpose:"page"})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(z.F,{daemonHealth:null==M?void 0:M.instance.daemonHealth,padding:{vertical:16,horizontal:24},border:"top"}),(()=>{if(eu)return(0,i.jsx)(o.x,{flex:{direction:"row",justifyContent:"center"},style:{paddingTop:"100px"},children:(0,i.jsxs)(o.x,{flex:{direction:"row",alignItems:"center",gap:16},children:[(0,i.jsx)(l.$,{purpose:"body-text"}),(0,i.jsx)("div",{style:{color:c.$()},children:"Loading sensors…"})]})});let n=e.length>t.length;return ee.length?(0,i.jsx)(S,{headerCheckbox:ec?(0,i.jsx)(L.W,{checkedCount:ed,totalCount:eo.length,onToggleAll:ea}):void 0,repos:ee,checkedKeys:ei,onToggleCheckFactory:es}):X?(0,i.jsx)(o.x,{padding:{top:20},children:(0,i.jsx)(d.t,{icon:"search",title:"No matching sensors",description:n?(0,i.jsxs)("div",{children:["No sensors matching ",(0,i.jsx)("strong",{children:a})," were found in the selected code locations"]}):(0,i.jsxs)("div",{children:["No sensors matching ",(0,i.jsx)("strong",{children:a})," were found in your definitions"]})})}):(0,i.jsx)(o.x,{padding:{top:20},children:(0,i.jsx)(d.t,{icon:"search",title:"No sensors",description:n?"No sensors were found in the selected code locations":"No sensors were found in your definitions"})})})()]})]})},G=e=>{let t=e.map(e=>e.locationOrLoadError),n=[];for(let e of t)if((null==e?void 0:e.__typename)==="RepositoryLocation")for(let t of e.repositories){let{name:r,sensors:i}=t,s=(0,Q.kQ)(r,e.name);i.length>0&&n.push({repoAddress:s,sensors:i})}return(0,E.S)(n)},Z=(0,a.Ps)(V(),p.i,M.B,D.O)},64895:function(e,t,n){n.d(t,{U:function(){return w},g:function(){return b}});var r=n(52322),i=n(14934),s=n(74159),a=n(51484),o=n(38491),l=n(43111),c=n(2784),d=n(69737),u=n(20171),h=n(4378),m=n(43250),p=n(92322),f=n(96850),g=n(30001);let x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dagster.run-timeline-hour-window",n=(0,c.useCallback)(t=>{switch(t){case"1":case"6":case"12":case"24":return t;default:return e}},[e]),[r,i]=(0,g.U)(t,n),s=(0,c.useCallback)(t=>{i(t||e)},[e,i]);return(0,c.useMemo)(()=>[r,s],[r,s])};var y=n(48162),j=n(100),v=n(65822);let k=e=>{switch(e){case"1":return 36e5;case"6":return 216e5;case"12":return 432e5;case"24":return 864e5}};function b(e){let{maxNowMs:t,hourWindowStorageKey:n,lookaheadHours:r=1}=e,[i,s]=x("12",n),[a,o]=c.useState(()=>t||Date.now()),[l,d]=c.useState(()=>0),u=c.useMemo(()=>[a-36e5*Number(i)+l,a+36e5*r+l],[i,a,r,l]);c.useEffect(()=>{let e=setInterval(()=>{o(t?Math.min(t,Date.now()):Date.now())},3e4);return()=>{clearInterval(e)}},[i,t]);let h=c.useCallback(()=>{d(e=>e-k(i))},[i]),m=c.useCallback(()=>{d(e=>e+k(i))},[i]);return{rangeMs:u,hourWindow:i,setHourWindow:s,onPageEarlier:h,onPageLater:m,onPageNow:c.useCallback(()=>{d(0)},[])}}let w=e=>{let{Header:t,TabButton:n}=e;(0,d.Px)(),(0,u.j)("Overview | Timeline");let g=(0,p.se)("OverviewTimelineRoot"),{allRepos:x,visibleRepos:k}=c.useContext(j.C5),{rangeMs:w,hourWindow:C,setHourWindow:S,onPageEarlier:E,onPageLater:T,onPageNow:M}=b({}),[O,P]=(0,h.q)({queryKey:"search",defaults:{search:""}}),B=(0,y.Zx)({rangeMs:w}),{jobs:A,loading:D,refreshState:I}=(0,c.useDeferredValue)(B);c.useEffect(()=>{D||g.endTrace()},[D,g]);let F=c.useMemo(()=>{let e=O.toLocaleLowerCase().trim();return new Set(k.flatMap(t=>{let n=(0,v.kQ)(t.repository.name,t.repositoryLocation.name);return t.repository.pipelines.filter(t=>{let{name:n}=t;return n.toLocaleLowerCase().includes(e)}).map(e=>(0,y.GL)(n,e.name))}))},[k,O]),N=c.useMemo(()=>A.filter(e=>{let{key:t}=e;return F.has(t)}),[A,F]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t,{refreshState:I}),(0,r.jsxs)(i.x,{padding:{horizontal:24,vertical:16},flex:{alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)(i.x,{flex:{direction:"row",alignItems:"center",gap:12,grow:0},children:[n&&(0,r.jsx)(n,{selected:"timeline"}),x.length>1&&(0,r.jsx)(m.C,{}),(0,r.jsx)(s.oi,{icon:"search",value:O,onChange:e=>P(e.target.value),placeholder:"Filter by job name…",style:{width:"200px"}})]}),(0,r.jsxs)(i.x,{flex:{direction:"row",gap:16,alignItems:"center"},children:[(0,r.jsx)(a.h,{activeItems:new Set([C]),buttons:[{id:"1",label:"1hr"},{id:"6",label:"6hr"},{id:"12",label:"12hr"},{id:"24",label:"24hr"}],onClick:e=>S(e)}),(0,r.jsxs)(i.x,{flex:{direction:"row",gap:4,alignItems:"center"},children:[(0,r.jsx)(o.zx,{onClick:E,children:"←"}),(0,r.jsx)(o.zx,{onClick:M,children:"Now"}),(0,r.jsx)(o.zx,{onClick:T,children:"→"})]})]})]}),(0,r.jsx)(l.S,{region:"timeline",children:(0,r.jsx)(f.qE,{loading:D,rangeMs:w,jobs:N})})]})}},907:function(e,t,n){n.d(t,{S:function(){return i}});var r=n(22563);let i=e=>[...e].sort((e,t)=>{let n=(0,r.Uz)(e.repoAddress),i=(0,r.Uz)(t.repoAddress);return n.localeCompare(i)})},49455:function(e,t,n){n.d(t,{S:function(){return s}});var r=n(65822),i=n(22563);let s=e=>new Set(e.map(e=>(0,i.Uz)((0,r.kQ)(e.repository.name,e.repositoryLocation.name))))},48162:function(e,t,n){n.d(t,{GL:function(){return O},Zx:function(){return M}});var r=n(73235),i=n(56675),s=n(89130),a=n(2784),o=n(13394);let l={expiry:new Date("3030-01-01")};class c{async loadCacheFromIndexedDB(){return this.indexedDBCache?(this.loadPromise||(this.loadPromise=new Promise(async e=>{if(!this.indexedDBCache)return;if(!await this.indexedDBCache.has(this.indexedDBKey)){e();return}let t=await this.indexedDBCache.get(this.indexedDBKey);t&&(this.cache=new Map(t.value)),e()})),await this.loadPromise):void 0}async saveCacheToIndexedDB(){if("undefined"!=typeof jest){if(!this.indexedDBCache)return;this.indexedDBCache.set(this.indexedDBKey,this.cache,l);return}clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{this.indexedDBCache&&this.indexedDBCache.set(this.indexedDBKey,this.cache,l)},1e4),this.registeredUnload||(this.registeredUnload=!0,window.addEventListener("beforeunload",()=>{this.indexedDBCache&&this.indexedDBCache.set(this.indexedDBKey,this.cache,l)}))}async clearOldEntries(){let e=Math.floor((Date.now()-6048e5)/36e5);for(let t of(await this.loadCacheFromIndexedDB(),this.cache.keys()))t<e&&this.cache.delete(t)}addData(e,t,n){let r=Math.floor(e/3600);if(Math.floor(t/3600)-r>1)throw Error("Expected all data to fit within an hour");this.addPartialData(r,e,t,n),this.notifySubscribers(r),this.saveCacheToIndexedDB()}addPartialData(e,t,n,r){this.cache.has(e)||this.cache.set(e,[]),this.cache.get(e).push({start:t,end:n,data:r}),this.cache.set(e,this.mergeIntervals(this.cache.get(e)))}getHourData(e){let t=Math.floor(e/3600);return this.cache.has(t)?this.cache.get(t).flatMap(e=>e.data):[]}getMissingIntervals(e){let t=Math.floor(e/3600);if(this.cache.has(t)&&1===this.cache.get(t).length&&this.cache.get(t)[0].end-this.cache.get(t)[0].start==3600)return[];let n=[],r=3600*t,i=(t+1)*3600,s=r;if(this.cache.has(t))for(let{start:e,end:r}of this.cache.get(t))e>s&&n.push([s,e]),s=Math.max(s,r);return s<i&&n.push([s,i]),n}isCompleteRange(e,t){let n=Math.floor(e/3600);if(Math.floor(t/3600)-n>1)throw Error("Expected the input range to be within a single hour");if(this.cache.has(n)){let r=this.cache.get(n),i=e;for(let{start:e,end:n}of r){if(e>i)return!1;if(n>=t)return!0;i=Math.max(i,n)}return i>=t}return!1}mergeIntervals(e){if(0===e.length)return[];e.sort((e,t)=>e.start-t.start);let t=[e[0]];for(let n of e.slice(1)){let e=t[t.length-1];n.start<=e.end?(e.end=Math.max(e.end,n.end),e.data=e.data.concat(n.data)):t.push(n)}return t}subscribe(e,t){let n=Math.floor(e/3600),r={hour:n,callback:t};return this.subscriptions.push(r),this.notifyExistingData(n,t),()=>{this.subscriptions=this.subscriptions.filter(e=>e!==r)}}notifySubscribers(e){for(let{hour:t,callback:n}of this.subscriptions)e>=t&&n(this.getCombinedData(t))}notifyExistingData(e,t){let n=this.getCombinedData(e);n.length>0&&t(n)}getCombinedData(e){let t=[];for(let[n,r]of this.cache)n>=e&&(t=t.concat(r.flatMap(e=>e.data)));return t}constructor(e,t="",n=1){this.cache=new Map,this.subscriptions=[],this.registeredUnload=!1,this.indexedDBKey=t?"".concat(t,"-hourlyData"):"hourlyData",indexedDB.deleteDatabase("HourlyDataCache:useRunsForTimeline"),e&&(this.indexedDBCache=(0,o.F)({dbName:"HourlyDataCache:".concat(e),maxCount:n}),this.loadCacheFromIndexedDB(),this.clearOldEntries())}}var d=n(59351),u=n(33182),h=n(77539),m=n(96961),p=n(4128),f=n(16336),g=n(44900),x=n(88257);function y(){let e=(0,r._)(["\n  fragment ScheduleFutureTicksFragment on Schedule {\n    id\n    executionTimezone\n    scheduleState {\n      id\n      status\n    }\n    futureTicks(cursor: $tickCursor, until: $ticksUntil) {\n      results {\n        timestamp\n      }\n    }\n  }\n"]);return y=function(){return e},e}let j=(0,s.Ps)(y());var v=n(34219),k=n(65822),b=n(22563),w=n(10539);function C(){let e=(0,r._)(["\n  fragment RunTimelineFragment on Run {\n    id\n    pipelineName\n    repositoryOrigin {\n      id\n      repositoryName\n      repositoryLocationName\n    }\n    ...RunTimeFragment\n  }\n  ","\n"]);return C=function(){return e},e}function S(){let e=(0,r._)(["\n  query OngoingRunTimelineQuery($inProgressFilter: RunsFilter!, $limit: Int!, $cursor: String) {\n    ongoing: runsOrError(filter: $inProgressFilter, limit: $limit, cursor: $cursor) {\n      ... on Runs {\n        results {\n          id\n          ...RunTimelineFragment\n        }\n      }\n    }\n  }\n\n  ","\n"]);return S=function(){return e},e}function E(){let e=(0,r._)(["\n  query CompletedRunTimelineQuery($completedFilter: RunsFilter!, $limit: Int!, $cursor: String) {\n    completed: runsOrError(filter: $completedFilter, limit: $limit, cursor: $cursor) {\n      ... on Runs {\n        results {\n          id\n          ...RunTimelineFragment\n        }\n      }\n    }\n  }\n\n  ","\n"]);return E=function(){return e},e}function T(){let e=(0,r._)(["\n  query FutureTicksQuery($tickCursor: Float, $ticksUntil: Float) {\n    workspaceOrError {\n      ... on Workspace {\n        id\n        locationEntries {\n          id\n          name\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                pipelines {\n                  id\n                  name\n                  isJob\n                }\n                schedules {\n                  id\n                  name\n                  pipelineName\n                  scheduleState {\n                    id\n                    status\n                  }\n                  ...ScheduleFutureTicksFragment\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  ","\n"]);return T=function(){return e},e}let M=e=>{let{rangeMs:t,filter:n,batchLimit:r=500,refreshInterval:s=2*f.dT,showTicks:o=!0}=e,l=(0,a.useMemo)(()=>null!=n?n:{},[n]),[u,y]=t,j=(0,a.useMemo)(()=>Math.min(Date.now(),y),[y]),b=u/1e3,C=j/1e3,S=(0,a.useMemo)(()=>(function(e,t){let n=[],r=3600*Math.floor(e/3600);e!==r&&n.push([e,Math.min(r+3600,t)]);let i=r+(e===r?0:3600);for(;i+3600<=t;){let e=i+3600;n.push([i,e]),i=e}return i<t&&n.push([i,t]),n})(b,C),[b,C]),E=(0,i.x)(),{localCacheIdPrefix:T}=(0,a.useContext)(p.I),M=(0,a.useMemo)(()=>n?new c(!!T&&"".concat(T,"-useRunsForTimeline-filtered"),JSON.stringify(n),3):new c(!!T&&"".concat(T,"-useRunsForTimeline")),[n,T]),[P,I]=(0,a.useState)([]);(0,a.useLayoutEffect)(()=>M.subscribe(b,e=>{I(e.filter(e=>e.startTime<=C&&e.updateTime>=C||e.updateTime>=b&&e.updateTime<=C))}),[M,j,C,b]);let[F,N]=(0,a.useState)({data:void 0,loading:!0,error:void 0,called:!1}),[z,L]=(0,a.useState)({data:void 0,loading:!0,error:void 0,called:!1}),{data:_}=z,[R,$]=(0,a.useState)(!1);(0,v.j$)("IndexedDBCache",R);let U=(0,a.useCallback)(async()=>(await M.loadCacheFromIndexedDB(),$(!0),await (0,m.N)({buckets:S.filter(e=>!M.isCompleteRange(e[0],e[1])).map(e=>{let t=e[0],n=e[1],r=M.getMissingIntervals(t);return r[0]&&(t=Math.max(r[0][0],t),n=Math.min(r[0][1],n)),[t,n]}),setQueryData:N,async fetchData(e,t){let n=e[1],i=e[0];if(M.isCompleteRange(i,n)&&!t)return{data:[],cursor:void 0,hasMore:!1,error:void 0};let{data:s}=await E.query({query:A,notifyOnNetworkStatusChange:!0,fetchPolicy:"no-cache",variables:{completedFilter:{...l,statuses:Array.from(d.cv),updatedBefore:n,updatedAfter:i},cursor:t,limit:r}});if("Runs"!==s.completed.__typename)return{data:[],cursor:void 0,hasMore:!1,error:s.completed};let a=s.completed.results;M.addData(i,n,a);let o=a.length===r;return{data:[],cursor:o?a[a.length-1].id:void 0,hasMore:o,error:void 0}}})),[r,S,E,M,l]),K=(0,a.useRef)(0),q=(0,a.useRef)(0),Q=(0,a.useRef)(0),V=(0,a.useCallback)(async()=>{let e=++q.current;L(e=>{let{data:t}=e;return{data:t,loading:!0,called:!0,error:void 0}});try{let t=await (0,m.B)({async fetchData(e){let{data:t}=await E.query({query:B,notifyOnNetworkStatusChange:!0,fetchPolicy:"no-cache",variables:{inProgressFilter:{...l,statuses:[x.VOA.CANCELING,x.VOA.STARTED]},cursor:e,limit:r}});if("Runs"!==t.ongoing.__typename)return{data:[],cursor:void 0,hasMore:!1,error:t.ongoing};let n=t.ongoing.results,i=n.length===r,s=i?n[n.length-1].id:void 0;return{data:n,cursor:s,hasMore:i,error:void 0}}});q.current===e&&L({data:t,loading:!1,called:!0,error:void 0})}catch(t){q.current===e&&L(e=>{let{data:n}=e;return{data:n,loading:!1,called:!0,error:t}})}},[E,l,r]),[H,J]=(0,a.useState)({data:void 0,called:!0,loading:!0,error:void 0}),W=(0,a.useCallback)(async()=>{let e=++Q.current,t=await E.query({query:D,variables:o?{tickCursor:b,ticksUntil:y/1e3}:{tickCursor:b,ticksUntil:b},fetchPolicy:"no-cache"});e===Q.current&&J({...t,called:!0})},[b,y,E,o]);(0,v.Hu)(z,"OngoingRunTimelineQuery"),(0,v.j$)("CompletedRunTimelineQuery",!F.loading);let{data:Y}=H,{workspaceOrError:G}=Y||{workspaceOrError:void 0},[Z,X]=(0,a.useState)(!0),ee=(0,a.useRef)({jobInfo:{},runsByJobKey:{}}),{runsByJobKey:et,jobInfo:en}=(0,a.useMemo)(()=>{if(Z)return ee.current;let e={},t={},n=Date.now();function r(r){if(null===r.startTime||!r.repositoryOrigin)return;let i=O({name:r.repositoryOrigin.repositoryName,location:r.repositoryOrigin.repositoryLocationName},r.pipelineName);if(t[i]=t[i]||{},t[i][r.id]={id:r.id,status:r.status,startTime:1e3*r.startTime,endTime:r.endTime?1e3*r.endTime:n},!e[i]&&r.repositoryOrigin){let t=r.pipelineName,n=(0,g.pv)(t),s=(0,k.kQ)(r.repositoryOrigin.repositoryName,r.repositoryOrigin.repositoryLocationName);e[i]={repoAddress:s,isAdHoc:n,pipelineName:t}}}P.forEach(r),null==_||_.forEach(r);let i={jobInfo:e,runsByJobKey:t};return ee.current=i,i},[Z,_,P]),er=(0,a.useMemo)(()=>{let e={};return Object.keys(et).length&&Object.entries(et).forEach(t=>{let[n,r]=t,i=Object.values(r),s=en[n];if(!s)return;let{pipelineName:a,isAdHoc:o,repoAddress:l}=s;e[n]={key:n,jobName:o?"Ad hoc materializations":a,jobType:o?"asset":"job",repoAddress:l,path:(0,w.jT)({repoName:l.name,repoLocation:l.location,pipelineName:a,isJob:!0}),runs:i}}),e},[en,et]),ei=(0,a.useMemo)(()=>Object.values(er),[er]),es=(0,a.useMemo)(()=>{if(!G||"PythonError"===G.__typename||y<Date.now())return ei;let e=new Set,t=[];for(let r of G.locationEntries){var n;if(!r.locationOrLoadError||(null===(n=r.locationOrLoadError)||void 0===n?void 0:n.__typename)==="PythonError")continue;let i=Date.now();for(let n of r.locationOrLoadError.repositories){let s=(0,k.kQ)(n.name,r.locationOrLoadError.name);for(let r of n.pipelines){let a=(n.schedules||[]).filter(e=>e.pipelineName===r.name),o=[];for(let e of a)e.scheduleState.status===x.ynu.RUNNING&&e.futureTicks.results.forEach(t=>{let{timestamp:n}=t,r=1e3*n;r>i&&(0,h.a)({start:u,end:y},{start:r,end:r})&&o.push({id:"".concat(e.pipelineName,"-future-run-").concat(n),status:"SCHEDULED",startTime:r,endTime:r+5e3})});let l=(0,g.pv)(r.name),c=O(s,r.name);if(l){if(e.has(c))continue;e.add(c)}let d=l?"Ad hoc materializations":r.name,m=Object.values(et[c]||{});if(!o.length&&!m.length)continue;let p=[...m,...o],f=er[c];f=f?{...f,runs:p}:{key:c,jobName:d,jobType:l?"asset":"job",repoAddress:s,path:(0,w.jT)({repoName:s.name,repoLocation:s.location,pipelineName:r.name,isJob:r.isJob}),runs:p},t.push(f)}}}return t},[G,ei,et,er]),ea=(0,a.useMemo)(()=>{let e=es.reduce((e,t)=>{let n=t.runs.map(e=>e.startTime);return e[t.key]=Math.min(...n),e},{});return es.sort((t,n)=>e[t.key]-e[n.key])},[es]),eo=(0,a.useRef)({ongoing:0,future:0}),el=(0,a.useRef)([0,0]);return Math.abs(el.current[0]-t[0])>3e4&&(eo.current.future=0),el.current=t,{jobs:ea,loading:Z,refreshState:(0,f.bT)({refresh:(0,a.useCallback)(async()=>{let e=++K.current;X(!0),await Promise.all([(async()=>{eo.current.ongoing<Date.now()-3e4&&(await V(),eo.current.ongoing=Date.now())})(),(async()=>{y>Date.now()&&eo.current.future<Date.now()-6e4&&W()})(),U()]),e===K.current&&X(!1)},[U,W,V,y]),intervalMs:s,leading:!0})}},O=(e,t)=>"".concat((0,g.pv)(t)?"__adhoc__":t,"-").concat((0,b.Uz)(e)),P=(0,s.Ps)(C(),u.$X),B=(0,s.Ps)(S(),P),A=(0,s.Ps)(E(),P),D=(0,s.Ps)(T(),j)}}]);
//# sourceMappingURL=8707.780d640bb133785f.js.map